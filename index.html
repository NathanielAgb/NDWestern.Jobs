<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ND Western | Careers</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- HERO -->
    <div id="hero-content">
      <h1>ND Western Careers</h1>
      <p>Explore exciting opportunities with ND Western.</p>
      <button class="btn" id="view-openings">
        View Openings
      </button>
    </div>

    <!-- OPENINGS (hidden until login) -->
    <div id="openings-cards" style="display:none;">
      <h2>Job Openings</h2>
      <p>Welcome ND Western staff! Here are the openings...</p>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
      import { getAuth, sendSignInLinkToEmail, isSignInWithEmailLink, signInWithEmailLink } 
        from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";

      // Firebase config (corrected)
      const firebaseConfig = {
        apiKey: "AIzaSyD-A7LDO1SjJNRp5tKCfwJJyUO2czdDglY",
        authDomain: "myform-project.firebaseapp.com",
        projectId: "myform-project",
        storageBucket: "myform-project.appspot.com",
        messagingSenderId: "296176283020",
        appId: "1:296176283020:web:83aaf97c1fe1c38c6e3aa9",
        measurementId: "G-X6ZP89KHZR"
      };

      // Init Firebase
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);

      const viewBtn = document.getElementById("view-openings");
      const heroContent = document.getElementById("hero-content");
      const openingsCards = document.getElementById("openings-cards");

      // Step 1: Send magic login link
      viewBtn.addEventListener("click", () => {
        const email = prompt("Enter your ND Western email:");

        if (!email || !email.endsWith("@ndwestern.com")) {
          alert("❌ Access restricted to ND Western staff.");
          return;
        }

        const actionCodeSettings = {
          url: window.location.href, // redirect to same page
          handleCodeInApp: true,
        };

        sendSignInLinkToEmail(auth, email, actionCodeSettings)
          .then(() => {
            window.localStorage.setItem("emailForSignIn", email);
            alert("✅ Check your ND Western email for the login link.");
          })
          .catch((error) => {
            alert("❌ Error: " + error.message);
          });
      });

      // Step 2: Check if user clicked email link
      window.addEventListener("DOMContentLoaded", () => {
        if (isSignInWithEmailLink(auth, window.location.href)) {
          let email = window.localStorage.getItem("emailForSignIn");
          if (!email) {
            email = prompt("Confirm your ND Western email");
          }

          signInWithEmailLink(auth, email, window.location.href)
            .then(() => {
              alert("✅ Welcome! You are signed in.");
              heroContent.style.display = "none";
              openingsCards.style.display = "block";
            })
            .catch((error) => {
              alert("❌ Error signing in: " + error.message);
            });
        }
      });
    </script>
  </body>
</html>
